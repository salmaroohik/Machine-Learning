{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "from nltk.corpus import stopwords \n",
    "from nltk.tokenize import WordPunctTokenizer"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "import warnings\n",
    "warnings.filterwarnings('ignore')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Using Latent Factor Collaborative Filtering"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_user = pd.read_csv('yelp_review_arizona.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_business = pd.read_csv('yelp_business.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>review_id</th>\n",
       "      <th>user_id</th>\n",
       "      <th>business_id</th>\n",
       "      <th>text</th>\n",
       "      <th>stars</th>\n",
       "      <th>date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>V93SYj2OLh5m9Cquzf-7kg</td>\n",
       "      <td>ZwVz20be-hOZnyAbevyMyQ</td>\n",
       "      <td>2c9Vptks_vowLgVUMnCgjw</td>\n",
       "      <td>Came here while in town for a country concert....</td>\n",
       "      <td>4.0</td>\n",
       "      <td>2013-09-04 01:29:46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>vNTFadc6T9HeH3Qa78dc_Q</td>\n",
       "      <td>91TB-gzcNyxFh46TL0pmnQ</td>\n",
       "      <td>6nKR80xEGHYf2UxAe_Cu_g</td>\n",
       "      <td>Best barbecue this side of the Mississippi!!!!...</td>\n",
       "      <td>5.0</td>\n",
       "      <td>2015-12-05 02:50:10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>SXRFBCt5eXCBF7TlI7UG6Q</td>\n",
       "      <td>Y_QBiZpATJoz8hKUfYF66A</td>\n",
       "      <td>fbQaKW0Lte0JQ_opbnjdKg</td>\n",
       "      <td>Absolutely amazing. Think Chipotle for enchila...</td>\n",
       "      <td>5.0</td>\n",
       "      <td>2014-04-01 01:56:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>CqMNjtG0hNZGhDw4RDE-zw</td>\n",
       "      <td>_Jg-IA0M-GSjBlGu-wmejg</td>\n",
       "      <td>r8764MtYyt8JhxMvrfM_xQ</td>\n",
       "      <td>I was really disappointed with my most recent ...</td>\n",
       "      <td>2.0</td>\n",
       "      <td>2014-10-11 03:53:53</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>5hZLouGEW4wm6BTJ5aNUNw</td>\n",
       "      <td>1CqkFliipv_X15WYn5aPfg</td>\n",
       "      <td>QS3QxI7u5PRdtbGgI0-UsA</td>\n",
       "      <td>I grade sushi restaurants on 3 factors:\\n- Qua...</td>\n",
       "      <td>4.0</td>\n",
       "      <td>2015-03-04 19:36:21</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                review_id                 user_id             business_id  \\\n",
       "0  V93SYj2OLh5m9Cquzf-7kg  ZwVz20be-hOZnyAbevyMyQ  2c9Vptks_vowLgVUMnCgjw   \n",
       "1  vNTFadc6T9HeH3Qa78dc_Q  91TB-gzcNyxFh46TL0pmnQ  6nKR80xEGHYf2UxAe_Cu_g   \n",
       "2  SXRFBCt5eXCBF7TlI7UG6Q  Y_QBiZpATJoz8hKUfYF66A  fbQaKW0Lte0JQ_opbnjdKg   \n",
       "3  CqMNjtG0hNZGhDw4RDE-zw  _Jg-IA0M-GSjBlGu-wmejg  r8764MtYyt8JhxMvrfM_xQ   \n",
       "4  5hZLouGEW4wm6BTJ5aNUNw  1CqkFliipv_X15WYn5aPfg  QS3QxI7u5PRdtbGgI0-UsA   \n",
       "\n",
       "                                                text  stars  \\\n",
       "0  Came here while in town for a country concert....    4.0   \n",
       "1  Best barbecue this side of the Mississippi!!!!...    5.0   \n",
       "2  Absolutely amazing. Think Chipotle for enchila...    5.0   \n",
       "3  I was really disappointed with my most recent ...    2.0   \n",
       "4  I grade sushi restaurants on 3 factors:\\n- Qua...    4.0   \n",
       "\n",
       "                  date  \n",
       "0  2013-09-04 01:29:46  \n",
       "1  2015-12-05 02:50:10  \n",
       "2  2014-04-01 01:56:00  \n",
       "3  2014-10-11 03:53:53  \n",
       "4  2015-03-04 19:36:21  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_user.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Select ratings and text from review dataset\n",
    "review_data = df_user[['user_id','business_id', 'stars', 'text']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[nltk_data] Downloading package stopwords to\n",
      "[nltk_data]     /Users/mangesh/nltk_data...\n",
      "[nltk_data]   Package stopwords is already up-to-date!\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import nltk\n",
    "nltk.download('stopwords')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [],
   "source": [
    "import string\n",
    "from nltk.corpus import stopwords\n",
    "stop = []\n",
    "for word in stopwords.words('english'):\n",
    "    s = [char for char in word if char not in string.punctuation]\n",
    "    stop.append(''.join(s))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "def review_text_process(rawtext):\n",
    "    \"\"\"\n",
    "    Takes in a string of text, then performs the following:\n",
    "    1. Remove all punctuation\n",
    "    2. Remove all stopwords\n",
    "    3. Returns a list of the cleaned text\n",
    "    \"\"\"\n",
    "    # Check characters to see if they are in punctuation\n",
    "    nopunc = [char for char in rawtext if char not in string.punctuation]\n",
    "\n",
    "    # Join the characters again to form the string.\n",
    "    nopunc = ''.join(nopunc)\n",
    "    \n",
    "    # Now just remove any stopwords\n",
    "    return \" \".join([word for word in nopunc.split() if word.lower() not in stop])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "review_data['text'] = review_data['text'].apply(review_text_process)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Split train test for testing the model later\n",
    "valid_size=0.15\n",
    "a_train, a_valid, b_train, b_valid = train_test_split(review_data['text'], df_user['business_id'], test_size = valid_size)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_userid = review_data[['user_id','text']]\n",
    "df_businessid = review_data[['business_id', 'text']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>user_id</th>\n",
       "      <th>text</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>ZwVz20be-hOZnyAbevyMyQ</td>\n",
       "      <td>Came town country concert better way start day...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>91TB-gzcNyxFh46TL0pmnQ</td>\n",
       "      <td>Best barbecue side Mississippi Come car washed...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Y_QBiZpATJoz8hKUfYF66A</td>\n",
       "      <td>Absolutely amazing Think Chipotle enchiladas N...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>_Jg-IA0M-GSjBlGu-wmejg</td>\n",
       "      <td>really disappointed recent visit Vintage 95 ma...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>1CqkFliipv_X15WYn5aPfg</td>\n",
       "      <td>grade sushi restaurants 3 factors Quality Exce...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  user_id                                               text\n",
       "0  ZwVz20be-hOZnyAbevyMyQ  Came town country concert better way start day...\n",
       "1  91TB-gzcNyxFh46TL0pmnQ  Best barbecue side Mississippi Come car washed...\n",
       "2  Y_QBiZpATJoz8hKUfYF66A  Absolutely amazing Think Chipotle enchiladas N...\n",
       "3  _Jg-IA0M-GSjBlGu-wmejg  really disappointed recent visit Vintage 95 ma...\n",
       "4  1CqkFliipv_X15WYn5aPfg  grade sushi restaurants 3 factors Quality Exce..."
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_userid.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>business_id</th>\n",
       "      <th>text</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>2c9Vptks_vowLgVUMnCgjw</td>\n",
       "      <td>Came town country concert better way start day...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>6nKR80xEGHYf2UxAe_Cu_g</td>\n",
       "      <td>Best barbecue side Mississippi Come car washed...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>fbQaKW0Lte0JQ_opbnjdKg</td>\n",
       "      <td>Absolutely amazing Think Chipotle enchiladas N...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>r8764MtYyt8JhxMvrfM_xQ</td>\n",
       "      <td>really disappointed recent visit Vintage 95 ma...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>QS3QxI7u5PRdtbGgI0-UsA</td>\n",
       "      <td>grade sushi restaurants 3 factors Quality Exce...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              business_id                                               text\n",
       "0  2c9Vptks_vowLgVUMnCgjw  Came town country concert better way start day...\n",
       "1  6nKR80xEGHYf2UxAe_Cu_g  Best barbecue side Mississippi Come car washed...\n",
       "2  fbQaKW0Lte0JQ_opbnjdKg  Absolutely amazing Think Chipotle enchiladas N...\n",
       "3  r8764MtYyt8JhxMvrfM_xQ  really disappointed recent visit Vintage 95 ma...\n",
       "4  QS3QxI7u5PRdtbGgI0-UsA  grade sushi restaurants 3 factors Quality Exce..."
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_businessid.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_userid = df_userid.groupby('user_id').agg({'text': ' '.join})\n",
    "df_businessid = df_businessid.groupby('business_id').agg({'text': ' '.join})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>text</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>user_id</th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>--2HUmLkcNHZp0xw6AMBPg</td>\n",
       "      <td>place JAM Surfer vibe great eats love machaca ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--4rAAfZnEIAKJE80aIiYg</td>\n",
       "      <td>pulled pork spicy bbq sauce impressed Probably...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--Nnm_506G_p8MxAOQna5w</td>\n",
       "      <td>Cant say burger anything special Taste ok Shak...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--ty7Z9fEt08E3dS3_qoSA</td>\n",
       "      <td>know think important trust Yelp kind reviews t...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>-0IiMAZI2SsQ7VmyzJjokQ</td>\n",
       "      <td>Ever fan roadside attractions Americana Id rea...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                                     text\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg  place JAM Surfer vibe great eats love machaca ...\n",
       "--4rAAfZnEIAKJE80aIiYg  pulled pork spicy bbq sauce impressed Probably...\n",
       "--Nnm_506G_p8MxAOQna5w  Cant say burger anything special Taste ok Shak...\n",
       "--ty7Z9fEt08E3dS3_qoSA  know think important trust Yelp kind reviews t...\n",
       "-0IiMAZI2SsQ7VmyzJjokQ  Ever fan roadside attractions Americana Id rea..."
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_userid.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.feature_extraction.text import TfidfVectorizer"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "The size of the user-vector matrix for is  (10937, 3000)\n"
     ]
    }
   ],
   "source": [
    "#userid vectorizer\n",
    "u_vectorizer = TfidfVectorizer(tokenizer = WordPunctTokenizer().tokenize, max_features=3000)\n",
    "u_vectors = u_vectorizer.fit_transform(df_userid['text'])\n",
    "print('The size of the user-vector matrix for is ',u_vectors.shape)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<10937x3000 sparse matrix of type '<class 'numpy.float64'>'\n",
       "\twith 1015365 stored elements in Compressed Sparse Row format>"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "u_vectors"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "The size of the restaurant-vector matrix for is  (1411, 3000)\n"
     ]
    }
   ],
   "source": [
    "#Business id vectorizer\n",
    "b_vectorizer = TfidfVectorizer(tokenizer = WordPunctTokenizer().tokenize, max_features=3000)\n",
    "b_vectors = b_vectorizer.fit_transform(df_businessid['text'])\n",
    "print('The size of the restaurant-vector matrix for is ',b_vectors.shape)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(10937, 1411)"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "user_rating_matrix = pd.pivot_table(review_data, values='stars', index=['user_id'], columns=['business_id'])\n",
    "user_rating_matrix.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>business_id</th>\n",
       "      <th>-050d_XIor1NpCuWkbIVaQ</th>\n",
       "      <th>-1UMR00eXtwaeh59pEiDjA</th>\n",
       "      <th>-4TMQnQJW1yd6NqGRDvAeA</th>\n",
       "      <th>-6h3K1hj0d4DRcZNUtHDuw</th>\n",
       "      <th>-8QlV3b_9H4BAh6LgMIr1g</th>\n",
       "      <th>-9eNGMp8XiygI8t8QFuFWw</th>\n",
       "      <th>-9nai28tnoylwViuJVrYEQ</th>\n",
       "      <th>-Bdw-5H5C4AYSMGnAvmnzw</th>\n",
       "      <th>-BxWyEIQ6wypT-37MzZizQ</th>\n",
       "      <th>-CfFjcCcGGDM9MVH_d42RQ</th>\n",
       "      <th>...</th>\n",
       "      <th>z_lDO8d8nkSmcvTjB4N69A</th>\n",
       "      <th>za9qr9ZZWLTfEgTfogRbUw</th>\n",
       "      <th>zbrFk-4ejesAJD8EwcdHxg</th>\n",
       "      <th>zfiSQ1dl3vTJ-og96eqXGA</th>\n",
       "      <th>zidkKI_N1OPxsiddTOQH_Q</th>\n",
       "      <th>zqNgwQjj0_XAll-neGikIw</th>\n",
       "      <th>zr93wrNyXzc-HW4IcK4iRQ</th>\n",
       "      <th>zrDi4gEaUi64lAMfJU51dw</th>\n",
       "      <th>zrTGcb83AsfyVTMrsCa65A</th>\n",
       "      <th>zuVvDYJkKAbXQTTBauAqJQ</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>user_id</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>--2HUmLkcNHZp0xw6AMBPg</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--4rAAfZnEIAKJE80aIiYg</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--Nnm_506G_p8MxAOQna5w</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--ty7Z9fEt08E3dS3_qoSA</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>-0IiMAZI2SsQ7VmyzJjokQ</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 1411 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "business_id             -050d_XIor1NpCuWkbIVaQ  -1UMR00eXtwaeh59pEiDjA  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             -4TMQnQJW1yd6NqGRDvAeA  -6h3K1hj0d4DRcZNUtHDuw  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             -8QlV3b_9H4BAh6LgMIr1g  -9eNGMp8XiygI8t8QFuFWw  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             -9nai28tnoylwViuJVrYEQ  -Bdw-5H5C4AYSMGnAvmnzw  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             -BxWyEIQ6wypT-37MzZizQ  -CfFjcCcGGDM9MVH_d42RQ  ...  \\\n",
       "user_id                                                                 ...   \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN  ...   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN  ...   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN  ...   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN  ...   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN  ...   \n",
       "\n",
       "business_id             z_lDO8d8nkSmcvTjB4N69A  za9qr9ZZWLTfEgTfogRbUw  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             zbrFk-4ejesAJD8EwcdHxg  zfiSQ1dl3vTJ-og96eqXGA  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             zidkKI_N1OPxsiddTOQH_Q  zqNgwQjj0_XAll-neGikIw  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             zr93wrNyXzc-HW4IcK4iRQ  zrDi4gEaUi64lAMfJU51dw  \\\n",
       "user_id                                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN   \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN   \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN   \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN   \n",
       "\n",
       "business_id             zrTGcb83AsfyVTMrsCa65A  zuVvDYJkKAbXQTTBauAqJQ  \n",
       "user_id                                                                 \n",
       "--2HUmLkcNHZp0xw6AMBPg                     NaN                     NaN  \n",
       "--4rAAfZnEIAKJE80aIiYg                     NaN                     NaN  \n",
       "--Nnm_506G_p8MxAOQna5w                     NaN                     NaN  \n",
       "--ty7Z9fEt08E3dS3_qoSA                     NaN                     NaN  \n",
       "-0IiMAZI2SsQ7VmyzJjokQ                     NaN                     NaN  \n",
       "\n",
       "[5 rows x 1411 columns]"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "user_rating_matrix.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [],
   "source": [
    "U = pd.DataFrame(u_vectors.toarray(), index=df_userid.index, columns=u_vectorizer.get_feature_names())\n",
    "B = pd.DataFrame(b_vectors.toarray(), index=df_businessid.index, columns=b_vectorizer.get_feature_names())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>1</th>\n",
       "      <th>10</th>\n",
       "      <th>100</th>\n",
       "      <th>1000</th>\n",
       "      <th>11</th>\n",
       "      <th>12</th>\n",
       "      <th>13</th>\n",
       "      <th>14</th>\n",
       "      <th>15</th>\n",
       "      <th>150</th>\n",
       "      <th>...</th>\n",
       "      <th>yet</th>\n",
       "      <th>yogurt</th>\n",
       "      <th>york</th>\n",
       "      <th>young</th>\n",
       "      <th>younger</th>\n",
       "      <th>yum</th>\n",
       "      <th>yummy</th>\n",
       "      <th>zero</th>\n",
       "      <th>zipps</th>\n",
       "      <th>zucchini</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>business_id</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>-050d_XIor1NpCuWkbIVaQ</td>\n",
       "      <td>0.008448</td>\n",
       "      <td>0.007774</td>\n",
       "      <td>0.019228</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.009450</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.012832</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.007973</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.010097</td>\n",
       "      <td>0.024571</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>-1UMR00eXtwaeh59pEiDjA</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>-4TMQnQJW1yd6NqGRDvAeA</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.029474</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>-6h3K1hj0d4DRcZNUtHDuw</td>\n",
       "      <td>0.029745</td>\n",
       "      <td>0.027372</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.016637</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.017776</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>-8QlV3b_9H4BAh6LgMIr1g</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.017901</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.019699</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 3000 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                               1        10       100  1000   11   12   13  \\\n",
       "business_id                                                                 \n",
       "-050d_XIor1NpCuWkbIVaQ  0.008448  0.007774  0.019228   0.0  0.0  0.0  0.0   \n",
       "-1UMR00eXtwaeh59pEiDjA  0.000000  0.000000  0.000000   0.0  0.0  0.0  0.0   \n",
       "-4TMQnQJW1yd6NqGRDvAeA  0.000000  0.000000  0.000000   0.0  0.0  0.0  0.0   \n",
       "-6h3K1hj0d4DRcZNUtHDuw  0.029745  0.027372  0.000000   0.0  0.0  0.0  0.0   \n",
       "-8QlV3b_9H4BAh6LgMIr1g  0.000000  0.017901  0.000000   0.0  0.0  0.0  0.0   \n",
       "\n",
       "                         14        15  150  ...       yet  yogurt      york  \\\n",
       "business_id                                 ...                               \n",
       "-050d_XIor1NpCuWkbIVaQ  0.0  0.009450  0.0  ...  0.012832     0.0  0.007973   \n",
       "-1UMR00eXtwaeh59pEiDjA  0.0  0.000000  0.0  ...  0.000000     0.0  0.000000   \n",
       "-4TMQnQJW1yd6NqGRDvAeA  0.0  0.000000  0.0  ...  0.000000     0.0  0.000000   \n",
       "-6h3K1hj0d4DRcZNUtHDuw  0.0  0.016637  0.0  ...  0.000000     0.0  0.000000   \n",
       "-8QlV3b_9H4BAh6LgMIr1g  0.0  0.000000  0.0  ...  0.019699     0.0  0.000000   \n",
       "\n",
       "                        young  younger       yum     yummy  zero  zipps  \\\n",
       "business_id                                                               \n",
       "-050d_XIor1NpCuWkbIVaQ    0.0      0.0  0.010097  0.024571   0.0    0.0   \n",
       "-1UMR00eXtwaeh59pEiDjA    0.0      0.0  0.000000  0.000000   0.0    0.0   \n",
       "-4TMQnQJW1yd6NqGRDvAeA    0.0      0.0  0.000000  0.029474   0.0    0.0   \n",
       "-6h3K1hj0d4DRcZNUtHDuw    0.0      0.0  0.017776  0.000000   0.0    0.0   \n",
       "-8QlV3b_9H4BAh6LgMIr1g    0.0      0.0  0.000000  0.000000   0.0    0.0   \n",
       "\n",
       "                        zucchini  \n",
       "business_id                       \n",
       "-050d_XIor1NpCuWkbIVaQ       0.0  \n",
       "-1UMR00eXtwaeh59pEiDjA       0.0  \n",
       "-4TMQnQJW1yd6NqGRDvAeA       0.0  \n",
       "-6h3K1hj0d4DRcZNUtHDuw       0.0  \n",
       "-8QlV3b_9H4BAh6LgMIr1g       0.0  \n",
       "\n",
       "[5 rows x 3000 columns]"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "B.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>1</th>\n",
       "      <th>10</th>\n",
       "      <th>100</th>\n",
       "      <th>1000</th>\n",
       "      <th>11</th>\n",
       "      <th>12</th>\n",
       "      <th>13</th>\n",
       "      <th>14</th>\n",
       "      <th>15</th>\n",
       "      <th>150</th>\n",
       "      <th>...</th>\n",
       "      <th>yet</th>\n",
       "      <th>yogurt</th>\n",
       "      <th>york</th>\n",
       "      <th>young</th>\n",
       "      <th>younger</th>\n",
       "      <th>yum</th>\n",
       "      <th>yummy</th>\n",
       "      <th>zero</th>\n",
       "      <th>zipps</th>\n",
       "      <th>zucchini</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>user_id</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>--2HUmLkcNHZp0xw6AMBPg</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--4rAAfZnEIAKJE80aIiYg</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--Nnm_506G_p8MxAOQna5w</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>--ty7Z9fEt08E3dS3_qoSA</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.210428</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>-0IiMAZI2SsQ7VmyzJjokQ</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 3000 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                          1   10  100  1000   11   12   13        14   15  \\\n",
       "user_id                                                                     \n",
       "--2HUmLkcNHZp0xw6AMBPg  0.0  0.0  0.0   0.0  0.0  0.0  0.0  0.000000  0.0   \n",
       "--4rAAfZnEIAKJE80aIiYg  0.0  0.0  0.0   0.0  0.0  0.0  0.0  0.000000  0.0   \n",
       "--Nnm_506G_p8MxAOQna5w  0.0  0.0  0.0   0.0  0.0  0.0  0.0  0.000000  0.0   \n",
       "--ty7Z9fEt08E3dS3_qoSA  0.0  0.0  0.0   0.0  0.0  0.0  0.0  0.210428  0.0   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ  0.0  0.0  0.0   0.0  0.0  0.0  0.0  0.000000  0.0   \n",
       "\n",
       "                        150  ...  yet  yogurt  york  young  younger  yum  \\\n",
       "user_id                      ...                                           \n",
       "--2HUmLkcNHZp0xw6AMBPg  0.0  ...  0.0     0.0   0.0    0.0      0.0  0.0   \n",
       "--4rAAfZnEIAKJE80aIiYg  0.0  ...  0.0     0.0   0.0    0.0      0.0  0.0   \n",
       "--Nnm_506G_p8MxAOQna5w  0.0  ...  0.0     0.0   0.0    0.0      0.0  0.0   \n",
       "--ty7Z9fEt08E3dS3_qoSA  0.0  ...  0.0     0.0   0.0    0.0      0.0  0.0   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ  0.0  ...  0.0     0.0   0.0    0.0      0.0  0.0   \n",
       "\n",
       "                        yummy  zero  zipps  zucchini  \n",
       "user_id                                               \n",
       "--2HUmLkcNHZp0xw6AMBPg    0.0   0.0    0.0       0.0  \n",
       "--4rAAfZnEIAKJE80aIiYg    0.0   0.0    0.0       0.0  \n",
       "--Nnm_506G_p8MxAOQna5w    0.0   0.0    0.0       0.0  \n",
       "--ty7Z9fEt08E3dS3_qoSA    0.0   0.0    0.0       0.0  \n",
       "-0IiMAZI2SsQ7VmyzJjokQ    0.0   0.0    0.0       0.0  \n",
       "\n",
       "[5 rows x 3000 columns]"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "U.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Gradient descent optimization algorithm\n",
    "\n",
    "def Vector_factors(R, U, B, steps=20, gamma=0.002,lamda=0.04):\n",
    "    for step in range(steps):\n",
    "        for i in R.index:\n",
    "            for j in R.columns:\n",
    "                if R.loc[i,j]>0:\n",
    "                    eij=R.loc[i,j]-np.dot(U.loc[i],B.loc[j])\n",
    "                    U.loc[i]=U.loc[i]+gamma*(eij*B.loc[j]-lamda*U.loc[i])\n",
    "                    B.loc[j]=B.loc[j]+gamma*(eij*U.loc[i]-lamda*B.loc[j])\n",
    "        e=0\n",
    "        for i in R.index:\n",
    "            for j in R.columns:\n",
    "                if R.loc[i,j]>0:\n",
    "                    e= e + pow(R.loc[i,j]-np.dot(U.loc[i],B.loc[j]),2)+lamda*(pow(np.linalg.norm(U.loc[i]),2)+pow(np.linalg.norm(B.loc[j]),2))\n",
    "        if e<0.001:\n",
    "            break\n",
    "        \n",
    "    return U,B"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "%%time\n",
    "U, B = Vector_factors(user_rating_matrix, U, B, steps=20, gamma=0.002,lamda=0.04)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "      <th>10</th>\n",
       "      <th>100</th>\n",
       "      <th>1000</th>\n",
       "      <th>101</th>\n",
       "      <th>1015</th>\n",
       "      <th>1030</th>\n",
       "      <th>10pm</th>\n",
       "      <th>11</th>\n",
       "      <th>...</th>\n",
       "      <th>z</th>\n",
       "      <th>zero</th>\n",
       "      <th>zest</th>\n",
       "      <th>zinburger</th>\n",
       "      <th>zinc</th>\n",
       "      <th>zipps</th>\n",
       "      <th>ziti</th>\n",
       "      <th>zookz</th>\n",
       "      <th>ztejas</th>\n",
       "      <th>zucchini</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>business_id</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>-050d_XIor1NpCuWkbIVaQ</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.008223</td>\n",
       "      <td>0.007567</td>\n",
       "      <td>0.018716</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.01094</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-1UMR00eXtwaeh59pEiDjA</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.00000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-4TMQnQJW1yd6NqGRDvAeA</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.00000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-6h3K1hj0d4DRcZNUtHDuw</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.028893</td>\n",
       "      <td>0.026588</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.00000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-8QlV3b_9H4BAh6LgMIr1g</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.017147</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.00000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 5000 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                          0         1        10       100  1000  101  1015  \\\n",
       "business_id                                                                  \n",
       "-050d_XIor1NpCuWkbIVaQ  0.0  0.008223  0.007567  0.018716   0.0  0.0   0.0   \n",
       "-1UMR00eXtwaeh59pEiDjA  0.0  0.000000  0.000000  0.000000   0.0  0.0   0.0   \n",
       "-4TMQnQJW1yd6NqGRDvAeA  0.0  0.000000  0.000000  0.000000   0.0  0.0   0.0   \n",
       "-6h3K1hj0d4DRcZNUtHDuw  0.0  0.028893  0.026588  0.000000   0.0  0.0   0.0   \n",
       "-8QlV3b_9H4BAh6LgMIr1g  0.0  0.000000  0.017147  0.000000   0.0  0.0   0.0   \n",
       "\n",
       "                           1030  10pm   11  ...    z  zero  zest  zinburger  \\\n",
       "business_id                                 ...                               \n",
       "-050d_XIor1NpCuWkbIVaQ  0.01094   0.0  0.0  ...  0.0   0.0   0.0        0.0   \n",
       "-1UMR00eXtwaeh59pEiDjA  0.00000   0.0  0.0  ...  0.0   0.0   0.0        0.0   \n",
       "-4TMQnQJW1yd6NqGRDvAeA  0.00000   0.0  0.0  ...  0.0   0.0   0.0        0.0   \n",
       "-6h3K1hj0d4DRcZNUtHDuw  0.00000   0.0  0.0  ...  0.0   0.0   0.0        0.0   \n",
       "-8QlV3b_9H4BAh6LgMIr1g  0.00000   0.0  0.0  ...  0.0   0.0   0.0        0.0   \n",
       "\n",
       "                        zinc  zipps  ziti  zookz  ztejas  zucchini  \n",
       "business_id                                                         \n",
       "-050d_XIor1NpCuWkbIVaQ   0.0    0.0   0.0    0.0     0.0       0.0  \n",
       "-1UMR00eXtwaeh59pEiDjA   0.0    0.0   0.0    0.0     0.0       0.0  \n",
       "-4TMQnQJW1yd6NqGRDvAeA   0.0    0.0   0.0    0.0     0.0       0.0  \n",
       "-6h3K1hj0d4DRcZNUtHDuw   0.0    0.0   0.0    0.0     0.0       0.0  \n",
       "-8QlV3b_9H4BAh6LgMIr1g   0.0    0.0   0.0    0.0     0.0       0.0  \n",
       "\n",
       "[5 rows x 5000 columns]"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "B.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "      <th>10</th>\n",
       "      <th>100</th>\n",
       "      <th>1000</th>\n",
       "      <th>101</th>\n",
       "      <th>1015</th>\n",
       "      <th>1030</th>\n",
       "      <th>10pm</th>\n",
       "      <th>11</th>\n",
       "      <th>...</th>\n",
       "      <th>z</th>\n",
       "      <th>zero</th>\n",
       "      <th>zest</th>\n",
       "      <th>zinburger</th>\n",
       "      <th>zinc</th>\n",
       "      <th>zipps</th>\n",
       "      <th>ziti</th>\n",
       "      <th>zookz</th>\n",
       "      <th>ztejas</th>\n",
       "      <th>zucchini</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>user_id</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>--2HUmLkcNHZp0xw6AMBPg</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>--4rAAfZnEIAKJE80aIiYg</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>--Nnm_506G_p8MxAOQna5w</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>--ty7Z9fEt08E3dS3_qoSA</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-0IiMAZI2SsQ7VmyzJjokQ</th>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 5000 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                          0    1   10  100  1000  101  1015  1030  10pm   11  \\\n",
       "user_id                                                                        \n",
       "--2HUmLkcNHZp0xw6AMBPg  0.0  0.0  0.0  0.0   0.0  0.0   0.0   0.0   0.0  0.0   \n",
       "--4rAAfZnEIAKJE80aIiYg  0.0  0.0  0.0  0.0   0.0  0.0   0.0   0.0   0.0  0.0   \n",
       "--Nnm_506G_p8MxAOQna5w  0.0  0.0  0.0  0.0   0.0  0.0   0.0   0.0   0.0  0.0   \n",
       "--ty7Z9fEt08E3dS3_qoSA  0.0  0.0  0.0  0.0   0.0  0.0   0.0   0.0   0.0  0.0   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ  0.0  0.0  0.0  0.0   0.0  0.0   0.0   0.0   0.0  0.0   \n",
       "\n",
       "                        ...    z  zero  zest  zinburger  zinc  zipps  ziti  \\\n",
       "user_id                 ...                                                  \n",
       "--2HUmLkcNHZp0xw6AMBPg  ...  0.0   0.0   0.0        0.0   0.0    0.0   0.0   \n",
       "--4rAAfZnEIAKJE80aIiYg  ...  0.0   0.0   0.0        0.0   0.0    0.0   0.0   \n",
       "--Nnm_506G_p8MxAOQna5w  ...  0.0   0.0   0.0        0.0   0.0    0.0   0.0   \n",
       "--ty7Z9fEt08E3dS3_qoSA  ...  0.0   0.0   0.0        0.0   0.0    0.0   0.0   \n",
       "-0IiMAZI2SsQ7VmyzJjokQ  ...  0.0   0.0   0.0        0.0   0.0    0.0   0.0   \n",
       "\n",
       "                        zookz  ztejas  zucchini  \n",
       "user_id                                          \n",
       "--2HUmLkcNHZp0xw6AMBPg    0.0     0.0       0.0  \n",
       "--4rAAfZnEIAKJE80aIiYg    0.0     0.0       0.0  \n",
       "--Nnm_506G_p8MxAOQna5w    0.0     0.0       0.0  \n",
       "--ty7Z9fEt08E3dS3_qoSA    0.0     0.0       0.0  \n",
       "-0IiMAZI2SsQ7VmyzJjokQ    0.0     0.0       0.0  \n",
       "\n",
       "[5 rows x 5000 columns]"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "U.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "matts        0.561022\n",
       "breakfast    0.315551\n",
       "wait         0.171394\n",
       "eggs         0.165935\n",
       "browns       0.135001\n",
       "food         0.133411\n",
       "bacon        0.129344\n",
       "toast        0.128572\n",
       "hash         0.116984\n",
       "place        0.116764\n",
       "Name: -050d_XIor1NpCuWkbIVaQ, dtype: float64"
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "B.iloc[0].sort_values(ascending=False).head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "love        0.262294\n",
       "vibe        0.240185\n",
       "fresh       0.237162\n",
       "place       0.224294\n",
       "earthy      0.208654\n",
       "machaca     0.192679\n",
       "oj          0.192118\n",
       "squeezed    0.174796\n",
       "jam         0.166092\n",
       "eats        0.165160\n",
       "Name: --2HUmLkcNHZp0xw6AMBPg, dtype: float64"
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "U.iloc[0].sort_values(ascending=False).head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Matt's Big Breakfast\n",
      "Breakfast & Brunch, Restaurants\n",
      "4.0 335\n",
      "\n",
      "Hangar Cafe\n",
      "Breakfast & Brunch, Restaurants\n",
      "4.0 287\n",
      "\n",
      "Breakfast Club- Scottsdale\n",
      "Coffee & Tea, Turkish, American (Traditional), Restaurants, Food, Sandwiches, Breakfast & Brunch\n",
      "4.0 1094\n",
      "\n",
      "Breakfast Club- CityScape\n",
      "Food, Coffee & Tea, Restaurants, American (Traditional), Breakfast & Brunch, Diners\n",
      "4.0 559\n",
      "\n",
      "Bisbee Breakfast Club\n",
      "Restaurants, Bakeries, Breakfast & Brunch, Sandwiches, Food\n",
      "3.5 208\n",
      "\n",
      "Scramble A Breakfast Joint\n",
      "Vegan, Restaurants, Sandwiches, Breakfast & Brunch, Gluten-Free, Pizza\n",
      "4.0 840\n",
      "\n",
      "Harlow's Cafe\n",
      "Burgers, Restaurants, Breakfast & Brunch, American (Traditional)\n",
      "4.0 470\n",
      "\n"
     ]
    }
   ],
   "source": [
    "search = \"Looking for american breakfast\"\n",
    "\n",
    "prediction_df= pd.DataFrame([search], columns=['text'])\n",
    "prediction_df['text'] = prediction_df['text'].apply(review_text_process)\n",
    "prediction_vectors = u_vectorizer.transform(prediction_df['text'])\n",
    "prediction_v_df = pd.DataFrame(prediction_vectors.toarray(), index=prediction_df.index, columns=u_vectorizer.get_feature_names())\n",
    "\n",
    "predictRating_i=pd.DataFrame(np.dot(prediction_v_df.loc[0],B.T),index=B.index,columns=['Rating'])\n",
    "topRecommendations=pd.DataFrame.sort_values(predictRating_i,['Rating'],ascending=[0])[:7]\n",
    "\n",
    "for i in topRecommendations.index:\n",
    "    print(df_business[df_business['business_id']==i]['name'].iloc[0])\n",
    "    print(df_business[df_business['business_id']==i]['categories'].iloc[0])\n",
    "    print(str(df_business[df_business['business_id']==i]['stars'].iloc[0])+ ' '+str(df_business[df_business['business_id']==i]['review_count'].iloc[0]))\n",
    "    print('')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Using Neighbourhood Method"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.metrics.pairwise import cosine_similarity"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#processing input text\n",
    "\n",
    "words = \"Looking for american breakfast\"\n",
    "test= pd.DataFrame([words], columns=['text'])\n",
    "test['text'] = test['text'].apply(review_text_process)\n",
    "test_vector = u_vectorizer.transform(test['text'])\n",
    "vector_df = pd.DataFrame(test_vector.toarray(), index=test.index, columns=u_vectorizer.get_feature_names())\n",
    "test_input = vector_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#calculating similarity scores\n",
    "\n",
    "index = []\n",
    "similarity = []\n",
    "aa = np.array(test_input).reshape(1,5000)\n",
    "\n",
    "for i in range(0,len(B)):\n",
    "    ab = np.array(B.iloc[i]).reshape(1,5000)\n",
    "    score = cosine_similarity(aa,ab)\n",
    "    index.append(i)\n",
    "    similarity.append(score)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#calculating average ratings for each restaurant\n",
    "business_ratings = review_data[['business_id','stars']]\n",
    "testing = business_ratings.groupby('business_id').agg(np.mean).reset_index()\n",
    "\n",
    "#combining ratings and similarities for each restaurant\n",
    "testing['similarity'] = similarity\n",
    "testing.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#generating final recommendations\n",
    "\n",
    "topRecommendations=testing.sort_values('similarity',ascending=[0])[:7]\n",
    "final = topRecommendations.sort_values('stars',ascending=[0])\n",
    "final.head()\n",
    "for i in final['business_id']:\n",
    "    print(df_business[df_business['business_id']==i]['name'].iloc[0])\n",
    "    print(df_business[df_business['business_id']==i]['categories'].iloc[0])\n",
    "    print(str(df_business[df_business['business_id']==i]['stars'].iloc[0])+ ' '+str(df_business[df_business['business_id']==i]['review_count'].iloc[0]))\n",
    "    print('')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
